# 登入畫面
>上方有Logo
>
>中間有帳密標籤及輸入欄位
>
>最下方有「登入」、「忘記密碼」、「加入會員」三個按鈕
><br>

## 工作
* 準備color、style設定
* 定義APP名稱
* 資料庫建置
* 登入畫面版面配置、程式撰寫<br>

### color.xml 加入
    <?xml version="1.0" encoding="utf-8"?>
    <resources>
        <color name="colorPrimary">#3F51B5</color>
        <color name="colorPrimaryDark">#303F9F</color>
        <color name="colorPrimaryDark_2">#C581C5</color>
        <color name="colorAccent">#FF4081</color>
    </resources>
    
### strings.xml 加入
    <resources>
        <string name="app_name">行動支付模擬器</string>
    </resources>
    
### styles.xml 加入
    <resources>

        <!-- Base application theme. -->
        <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
            <!-- Customize your theme here. -->
            <item name="colorPrimary">@color/colorPrimary</item>
            <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
            <item name="colorAccent">@color/colorAccent</item>
        </style>

        <style name="lay_pair_button">
            <item name="android:layout_width">wrap_content</item>
            <item name="android:layout_height">wrap_content</item>
            <item name="android:orientation">horizontal</item>
            <item name="android:paddingBottom">5dp</item>
            <item name="android:layout_gravity">center_horizontal</item>
            <item name="android:layout_marginTop">@dimen/pair_button_marginTop</item>
        </style>

        <style name="btn_pair_button">
            <item name="android:layout_width">103dp</item>
            <item name="android:layout_height">45dp</item>
        </style>
    </resources>
    
### activity_main.xml 加入
    <?xml version="1.0" encoding="utf-8"?>
    <LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:id="@+id/activity_main"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"
        tools:context="com.vincent.user.mobilepaysimulator.MainActivity">

        <FrameLayout
            android:layout_width="match_parent"
            android:layout_height="match_parent">
            <ImageView
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:src="@drawable/bg_login"
                android:scaleType="centerCrop"/>

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:paddingBottom="@dimen/activity_vertical_margin"
                android:paddingLeft="@dimen/activity_horizontal_margin"
                android:paddingRight="@dimen/activity_horizontal_margin"
                android:paddingTop="@dimen/activity_vertical_margin"
                android:orientation="vertical">

                <ImageView
                    android:src="@drawable/img_logo"
                    android:layout_width="280dp"
                    android:layout_height="280dp"
                    android:layout_marginTop="10dp"
                    android:layout_marginBottom="5dp"
                    android:layout_gravity="center_horizontal" /> 

                <TableLayout
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:orientation="horizontal">
                    <TableRow>
                        <ImageView
                            android:src="@drawable/img_login_acco"
                            android:layout_width="60dp"
                            android:layout_height="40dp"
                            android:layout_marginTop="2dp"
                            android:layout_gravity="center_vertical"/>
                        <EditText
                            android:id="@+id/edtAccount"
                            style="@style/edt_register_content"
                            android:layout_width="200dp"
                            android:layout_height="wrap_content"
                            android:maxLines="1"
                            android:text="eric61011"/>
                    </TableRow>
                    <TableRow
                        android:layout_marginTop="5dp">
                        <ImageView
                            android:src="@drawable/img_login_passw"
                            android:layout_width="60dp"
                            android:layout_height="40dp"
                            android:layout_marginTop="2dp"
                            android:layout_gravity="center_vertical"/>
                        <EditText
                            android:id="@+id/edtSecurePwd"
                            style="@style/edt_register_content"
                            android:inputType="textPassword"
                            android:text="aaaaaa"/>
                    </TableRow>

                </TableLayout>

                <CheckBox
                    android:id="@+id/chkKeepLogin"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginEnd="68dp"
                    android:text="保持帳號登入"
                    android:textSize="16sp"/>

                <LinearLayout
                    style="@style/lay_pair_button"
                    android:layout_marginTop="15dp">
                    <ImageButton
                        style="@style/btn_pair_button"
                        android:background="@drawable/btn_login"
                        android:onClick="onclickLogin"/>
                    <ImageButton
                        style="@style/btn_pair_button"
                        android:layout_marginStart="10dp"
                        android:layout_marginEnd="10dp"
                        android:background="@drawable/btn_forget"
                        android:onClick="onclickForget"/>
                    <ImageButton
                        style="@style/btn_pair_button"
                        android:background="@drawable/btn_register"
                        android:onClick="onclickRegister"/>
                </LinearLayout>
            </LinearLayout>

        </FrameLayout>

    </LinearLayout>
    
### MyDBHelper.java 加入
    public class MyDBHelper extends SQLiteOpenHelper {

        public MyDBHelper(Context context) {
            super(context, "MobilePay", null, 1);
        }

        @Override
        public void onCreate(SQLiteDatabase db) {
            db.execSQL("create table 會員資料(" +
                    "會員編號 TEXT PRIMARY KEY, " +
                    "帳號 TEXT NOT NULL, " +
                    "登入密碼 TEXT NOT NULL, " +
                    "安全密碼 TEXT NOT NULL, " +
                    "姓名 TEXT NOT NULL, " +
                    "性別 TEXT NOT NULL, " +
                    "生日 TEXT NOT NULL, " +
                    "電子郵件 TEXT NOT NULL, " +
                    "註冊日期 TEXT NOT NULL" +
                    ");"
            );

            db.execSQL("create table 金流紀錄(" +
                    "交易編號 TEXT PRIMARY KEY, " +
                    "匯款方 TEXT NOT NULL, " +
                    "收款方 TEXT NOT NULL, " +
                    "日期 TEXT NOT NULL, " +
                    "時間 TEXT NOT NULL, " +
                    "摘要 TEXT NOT NULL, " +
                    "金額 INTEGER NOT NULL, " +
                    "留言 TEXT, " +
                    "FOREIGN KEY(匯款方) REFERENCES 會員資料(會員編號), " +
                    "FOREIGN KEY(收款方) REFERENCES 會員資料(會員編號)" +
                    ");"
            );

            db.execSQL("create table 投資報酬(" +
                    "日期 TEXT PRIMARY KEY, " +
                    "單位收益 REAL NOT NULL" +
                    ");"
            );

            db.execSQL("create table 會員投資歷史(" +
                    "會員編號 TEXT, " +
                    "日期 TEXT, " +
                    "當日投資金額 REAL NOT NULL, " +
                    "收益加成 REAL NOT NULL, " +
                    "實際收益 REAL NOT NULL, " +
                    "FOREIGN KEY(會員編號) REFERENCES 會員資料(會員編號), " +
                    "FOREIGN KEY(日期) REFERENCES 投資報酬(日期)" +
                    ");"
            );

            db.execSQL("create table 會員投資狀況(" +
                    "會員編號 TEXT PRIMARY KEY, " +
                    "投資金額 REAL NOT NULL, " +
                    "待確認總金額 INTEGER NOT NULL, " +
                    "收益加成 REAL NOT NULL, " +
                    "FOREIGN KEY(會員編號) REFERENCES 會員資料(會員編號)" +
                    ");"
            );

            db.execSQL("create table 投資待確認金額(" +
                    "會員編號 TEXT NOT NULL, " +
                    "金額 INTEGER NOT NULL, " +
                    "確認完成日 TEXT NOT NULL, " +
                    "旗標 INTEGER NOT NULL, " +
                    "FOREIGN KEY(會員編號) REFERENCES 會員資料(會員編號)" +
                    ");"
            );
        }

        @Override
        public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
            db.execSQL("drop table if exists 投資待確認金額");
            db.execSQL("drop table if exists 會員投資歷史");
            db.execSQL("drop table if exists 投資報酬");
            db.execSQL("drop table if exists 金流紀錄");
            db.execSQL("drop table if exists 會員資料");
            onCreate(db);
        }
    }

### MainActivity.java 加入
    public class MainActivity extends Activity {
        public static String userId = "";
        public static String username = "";
        private EditText edtAcc, edtPwd;
        private CheckBox chkKeepLogin;
        private SharedPreferences keepLogin;

        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);

            edtAcc = (EditText) findViewById(R.id.edtAccount);
            edtPwd = (EditText) findViewById(R.id.edtSecurePwd);
            chkKeepLogin = (CheckBox) findViewById(R.id.chkKeepLogin);

            autoRegister("eric61011", "鄭仲佑","N"); //N1
            autoRegister("WithdrawAgent", "提款服務員", "S"); //S1
            autoRegister("InvestAgent", "投資服務員", "S"); //S2

            //更新投資報酬

            //判斷是否自動登入
            keepLogin = getSharedPreferences("KeepLogin", MODE_PRIVATE);
            if (keepLogin.getBoolean("isAutoLogin", false)) {
                userId = keepLogin.getString("userId", "");
                username = keepLogin.getString("username", "");
                startActivity(new Intent(this, OperateActivity.class));
            }
        }


        public void onclickLogin(View view) {
            String enterAcc = edtAcc.getText().toString();
            String enterPwd = edtPwd.getText().toString();

            MyDBHelper myDBHelper = new MyDBHelper(this);
            SQLiteDatabase db = myDBHelper.getWritableDatabase();
            Cursor cursor = db.query("會員資料", new String[]{"登入密碼, 會員編號"}, "帳號 = ?", new String[]{enterAcc}, null, null, null);

            if (cursor.getCount() != 0) {
                cursor.moveToNext();
                if (cursor.getString(0).equals(enterPwd)) {
                    username = enterAcc;
                    userId = cursor.getString(1);

                    if (chkKeepLogin.isChecked()) {
                        //將是否保持登入寫入偏好設定
                        keepLogin.edit()
                                .putString("username", username)
                                .putString("userId", userId)
                                .putBoolean("isAutoLogin", true)
                                .apply();
                    }else {
                        keepLogin.edit()
                                .putString("username", "")
                                .putString("userId", "")
                                .putBoolean("isAutoLogin", false)
                                .apply();
                    }

                    startActivity(new Intent(this, OperateActivity.class));
                }else Toast.makeText(this, "帳號或密碼錯誤", Toast.LENGTH_SHORT).show();
            }else {
                Toast.makeText(this, "帳號或密碼錯誤", Toast.LENGTH_SHORT).show();
            }

            cursor.close();
            db.close();
        }

        public void onclickForget(View view) {
            startActivity(new Intent(this, ForgetActivity.class));
        }

        public void onclickRegister(View view) {
            startActivity(new Intent(this, RegisterActivity.class));
        }

        private void autoRegister(String account, String name, String prefix) {
            MyDBHelper myDBHelper = new MyDBHelper(this);
            SQLiteDatabase db = myDBHelper.getWritableDatabase();
            Cursor cursor = db.rawQuery("select 會員編號 from 會員資料 where 帳號 = ?", new String[]{account});

            if (cursor.getCount() == 0) {
                String memberId = myDBHelper.createNo("會員編號", "會員資料", prefix);

                ContentValues values = new ContentValues();
                values.put("會員編號", memberId);
                values.put("帳號", account);
                values.put("登入密碼", "aaaaaa");
                values.put("安全密碼", "bbbbbb");
                values.put("姓名", name);
                values.put("性別", "男");
                values.put("生日", "1996/03/05");
                values.put("電子郵件", "eric61011@gmail.com");
                values.put("註冊日期", "2017/04/01");

                long rowID = db.insert("會員資料", null, values);
                cursor.close();
                db.close();
            }
        }
